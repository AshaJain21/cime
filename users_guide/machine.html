
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>4. Defining the machine &#8212; CIME 5.6 documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5. Controlling processors and threads" href="pes-threads.html" />
    <link rel="prev" title="3. Model grids" href="grids.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="pes-threads.html" title="5. Controlling processors and threads"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="grids.html" title="3. Model grids"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">CIME 5.6 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Case Control System Part 1: Basic Usage</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="defining-the-machine">
<span id="machine"></span><h1>4. Defining the machine<a class="headerlink" href="#defining-the-machine" title="Permalink to this headline">¶</a></h1>
<p>CIME looks at the xml node <code class="docutils literal notranslate"><span class="pre">MACHINE_SPEC_FILE</span></code> in the <strong>config_files.xml</strong> file to identify supported out-of-the-box machines for the target model. The node has the following contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;entry id=&quot;MACHINES_SPEC_FILE&quot;&gt;
  &lt;type&gt;char&lt;/type&gt;
  &lt;default_value&gt;$CIMEROOT/cime_config/$MODEL/machines/config_machines.xml&lt;/default_value&gt;
  &lt;group&gt;case_last&lt;/group&gt;
  &lt;file&gt;env_case.xml&lt;/file&gt;
  &lt;desc&gt;file containing machine specifications for target model primary component (for documentation only - DO NOT EDIT)&lt;/desc&gt;
  &lt;schema&gt;$CIMEROOT/cime_config/xml_schemas/config_machines.xsd&lt;/schema&gt;
&lt;/entry&gt;
</pre></div>
</div>
<p>You can supplement what is in the MACHINES_SPEC_FILE by adding a config_machines.xml file to your CIME config directory.</p>
<div class="section" id="config-machines-xml-machine-specific-file">
<span id="machinefile"></span><h2>4.1. config_machines.xml - machine specific file<a class="headerlink" href="#config-machines-xml-machine-specific-file" title="Permalink to this headline">¶</a></h2>
<p>Each <code class="docutils literal notranslate"><span class="pre">&lt;machine&gt;</span></code> tag requires the following input:</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">DESC</span></code>: a text description of the machine</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">NODENAME_REGEX</span></code>: a regular expression used to identify the machine. It must work on compute nodes as well as login nodes.
| Use the <code class="docutils literal notranslate"><span class="pre">machine</span></code> option for <strong>create_test</strong> or <strong>create_newcase</strong> if this flag is not available.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">OS</span></code>: the machine’s operating system</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">PROXY</span></code>: optional http proxy for access to the internet</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">COMPILERS</span></code>: compilers supported on the machine, in comma-separated list, default first</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">MPILIBS</span></code>: mpilibs supported on the machine, in comma-separated list, default first</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">PROJECT</span></code>: a project or account number used for batch jobs; can be overridden in environment or in <strong>$HOME/.cime/config</strong></p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">SAVE_TIMING_DIR</span></code>: (E3SM only) target directory for archiving timing output</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">SAVE_TIMING_DIR_PROJECTS</span></code>: (E3SM only) projects whose jobs archive timing output</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">CIME_OUTPUT_ROOT</span></code>: Base directory for case output; the <strong>bld</strong> and <strong>run</strong> directories are written below here</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">DIN_LOC_ROOT</span></code>: location of the input data directory</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">DIN_LOC_ROOT_CLMFORC</span></code>: optional input location for clm forcing data</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">DOUT_S_ROOT</span></code>: root directory of short-term archive files</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">DOUT_L_MSROOT</span></code>: root directory on mass store system for long-term archive files</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">BASELINE_ROOT</span></code>: root directory for system test baseline files</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">CCSM_CPRNC</span></code>: location of the cprnc tool, which compares model output in testing</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">GMAKE</span></code>: gnu-compatible make tool; default is “gmake”</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">GMAKE_J</span></code>: optional number of threads to pass to the gmake flag</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">TESTS</span></code>: (E3SM only) list of tests to run on the machine</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">BATCH_SYSTEM</span></code>: batch system used on this machine (none is okay)</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">SUPPORTED_BY</span></code>: contact information for support for this system</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">MAX_TASKS_PER_NODE</span></code>: maximum number of threads/tasks per shared memory node on the machine</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">MAX_MPITASKS_PER_NODE</span></code>: number of physical PES per shared node on the machine. In practice the MPI tasks per node will not exceed this value.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">PROJECT_REQUIRED</span></code>: Does this machine require a project to be specified to the batch system?</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">mpirun</span></code>: The mpi exec to start a job on this machine.
This is itself an element that has sub-elements that must be filled:</p>
<ul class="simple">
<li>Must have a required <code class="docutils literal notranslate"><span class="pre">&lt;executable&gt;</span></code> element</li>
<li>May have optional attributes of <code class="docutils literal notranslate"><span class="pre">compiler</span></code>, <code class="docutils literal notranslate"><span class="pre">mpilib</span></code> and/or <code class="docutils literal notranslate"><span class="pre">threaded</span></code></li>
<li>May have an optional <code class="docutils literal notranslate"><span class="pre">&lt;arguments&gt;</span></code> element which in turn contains one or more <code class="docutils literal notranslate"><span class="pre">&lt;arg&gt;</span></code> elements.
These specify the arguments to the mpi executable and are dependent on your mpi library implementation.</li>
</ul>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">module_system</span></code>: How and what modules to load on this system. Module systems allow you to easily load multiple compiler environments on a machine. CIME provides support for two types of module tools: <a class="reference external" href="http://www.tacc.utexas.edu/tacc-projects/mclay/lmod">module</a> and <a class="reference external" href="http://www.mcs.anl.gov/hs/software/systems/softenv/softenv-intro.html">soft</a>. If neither of these is available on your machine, simply set <code class="docutils literal notranslate"><span class="pre">&lt;module_system</span> <span class="pre">type=&quot;none&quot;\&gt;</span></code>.</p>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">environment_variables</span></code>: environment_variables to set on the system</dt>
<dd><p class="first">This contains sub-elements <code class="docutils literal notranslate"><span class="pre">&lt;env&gt;</span></code> with the <code class="docutils literal notranslate"><span class="pre">name</span></code> attribute specifying the environment variable name, and the element value specifying the corresponding environment variable value. If the element value is not set, the corresponding environment variable will be unset in your shell.</p>
<p>For example, the following sets the environment variable <code class="docutils literal notranslate"><span class="pre">OMP_STACKSIZE</span></code> to 256M:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">env</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;OMP_STACKSIZE&quot;</span><span class="o">&gt;</span><span class="mi">256</span><span class="n">M</span><span class="o">&lt;/</span><span class="n">env</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The following unsets this environment variable in the shell:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">env</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;OMP_STACKSIZE&quot;</span><span class="o">&gt;&lt;/</span><span class="n">env</span><span class="o">&gt;</span>
</pre></div>
</div>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">These changes are <strong>ONLY</strong> activated for the CIME build and run environment, <strong>BUT NOT</strong> for your login shell. To activate them for your login shell, source either <strong>$CASEROOT/.env_mach_specific.sh</strong> or <strong>$CASEROOT/.env_mach_specific.csh</strong>, depending on your shell.</p>
</div>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="batch-system-definition">
<h2>4.2. Batch system definition<a class="headerlink" href="#batch-system-definition" title="Permalink to this headline">¶</a></h2>
<p>CIME looks at the xml node <code class="docutils literal notranslate"><span class="pre">BATCH_SPEC_FILE</span></code> in the <strong>config_files.xml</strong> file to identify supported out-of-the-box batch system details for the target model. The node has the following contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;entry id=&quot;BATCH_SPEC_FILE&quot;&gt;
  &lt;type&gt;char&lt;/type&gt;
  &lt;default_value&gt;$CIMEROOT/cime_config/$MODEL/machines/config_batch.xml&lt;/default_value&gt;
  &lt;group&gt;case_last&lt;/group&gt;
  &lt;file&gt;env_case.xml&lt;/file&gt;
  &lt;desc&gt;file containing batch system details for target system  (for documentation only - DO NOT EDIT)&lt;/desc&gt;
  &lt;schema&gt;$CIMEROOT/cime_config/xml_schemas/config_batch.xsd&lt;/schema&gt;
&lt;/entry&gt;
</pre></div>
</div>
</div>
<div class="section" id="config-batch-xml-batch-directives">
<span id="batchfile"></span><h2>4.3. config_batch.xml - batch directives<a class="headerlink" href="#config-batch-xml-batch-directives" title="Permalink to this headline">¶</a></h2>
<p>The <strong>config_batch.xml</strong> schema is defined in <strong>$CIMEROOT/config/xml_schemas/config_batch.xsd</strong>.</p>
<p>CIME supports these batch systems: pbs, cobalt, lsf and slurm.</p>
<p>As is the case for <strong>config_compilers.xml</strong>, the entries in <strong>config_batch.xml</strong> are hierarchical.</p>
<ol class="arabic simple">
<li>General configurations for each system are provided at the top of the file.</li>
<li>Specific modifications for a given machine are provided below.  In particular each machine should define its own queues.</li>
<li>Following is a machine-specific queue section.  This section details the parameters for each queue on the target machine.</li>
<li>The last section describes several things:<ul>
<li>each job that will be submitted to the queue for a CIME workflow,</li>
<li>the template file that will be used to generate that job,</li>
<li>the prerequisites that must be met before the job is submitted, and</li>
<li>the dependencies that must be satisfied before the job is run.</li>
</ul>
</li>
</ol>
<p>By default the CIME workflow consists of two jobs (<strong>case.run</strong>, <strong>case.st_archive</strong>).</p>
<p>In addition, there is <strong>case.test</strong> job that is used by the CIME system test workflow.</p>
</div>
<div class="section" id="compiler-settings">
<span id="defining-compiler-settings"></span><h2>4.4. Compiler settings<a class="headerlink" href="#compiler-settings" title="Permalink to this headline">¶</a></h2>
<p>CIME looks at the xml element <code class="docutils literal notranslate"><span class="pre">COMPILERS_SPEC_FILE</span></code> in the <strong>config_files.xml</strong> file to identify supported out-of-the-box compiler details for the target model. The node has the following contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;entry id=&quot;COMPILERS_SPEC_FILE&quot;&gt;
  &lt;type&gt;char&lt;/type&gt;
  &lt;default_value&gt;$CIMEROOT/cime_config/$MODEL/machines/config_compilers.xml&lt;/default_value&gt;
  &lt;group&gt;case_last&lt;/group&gt;
  &lt;file&gt;env_case.xml&lt;/file&gt;
  &lt;desc&gt;file containing compiler specifications for target model primary component (for documentation only - DO NOT EDIT)&lt;/desc&gt;
  &lt;schema&gt;$CIMEROOT/cime_config/xml_schemas/config_compilers_v2.xsd&lt;/schema&gt;
&lt;/entry&gt;
</pre></div>
</div>
<p>Additional compilers are made avilable by adding entries to the files pointed to by COMPILERS_SPEC_FILE or to a config_compilers.xml file
in your CIME config directory.</p>
</div>
<div class="section" id="config-compilers-xml-compiler-paths-and-options">
<span id="compilerfile"></span><h2>4.5. config_compilers.xml - compiler paths and options<a class="headerlink" href="#config-compilers-xml-compiler-paths-and-options" title="Permalink to this headline">¶</a></h2>
<p>The <strong>config_compilers.xml</strong> file defines compiler flags for building CIME (and also CESM and E3SM prognostic CIME-driven components).</p>
<ol class="arabic simple">
<li>General compiler flags (e.g., for the gnu compiler) that are machine- and componen-independent are listed first.</li>
<li>Compiler flags specific to a particular operating system are listed next.</li>
<li>Compiler flags that are specific to particular machines are listed next.</li>
<li>Compiler flags that are specific to particular CIME-driven components are listed last.</li>
</ol>
<p>The order of listing is a convention and not a requirement.</p>
<p>The possible elements and attributes that can exist in the file are documented in <strong>$CIME/config/xml_schemas/config_compilers_v2.xsd</strong>.</p>
<p>To clarify several conventions:</p>
<ul>
<li><p class="first">The <code class="docutils literal notranslate"><span class="pre">&lt;append&gt;</span></code> element implies that any previous definition of that element’s parent will be appended with the new element value.
As an example, the following entry in <strong>config_compilers.xml</strong> would append the value of <code class="docutils literal notranslate"><span class="pre">CPPDEFS</span></code> with <code class="docutils literal notranslate"><span class="pre">-D</span> <span class="pre">$OS</span></code> where <code class="docutils literal notranslate"><span class="pre">$OS</span></code> is the environment value of <code class="docutils literal notranslate"><span class="pre">OS</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">compiler</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">CPPDEFS</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">append</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">D</span><span class="o">&lt;</span><span class="n">env</span><span class="o">&gt;</span><span class="n">OS</span><span class="o">&lt;/</span><span class="n">env</span><span class="o">&gt;</span> <span class="o">&lt;/</span><span class="n">append</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">CPPDEFS</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">compiler</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p class="first">The <code class="docutils literal notranslate"><span class="pre">&lt;base&gt;</span></code> element overwrites its parent element’s value. For example, the following entry would overwrite the <code class="docutils literal notranslate"><span class="pre">CONFIG_ARGS</span></code> for machine <code class="docutils literal notranslate"><span class="pre">melvin</span></code> with a <code class="docutils literal notranslate"><span class="pre">gnu</span></code> compiler to be <code class="docutils literal notranslate"><span class="pre">--host=Linux</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">compiler</span> <span class="n">MACH</span><span class="o">=</span><span class="s2">&quot;melvin&quot;</span> <span class="n">COMPILER</span><span class="o">=</span><span class="s2">&quot;gnu&quot;</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">CONFIG_ARGS</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">base</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">host</span><span class="o">=</span><span class="n">Linux</span> <span class="o">&lt;/</span><span class="n">base</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">CONFIG_ARGS</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">compiler</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">4. Defining the machine</a><ul>
<li><a class="reference internal" href="#config-machines-xml-machine-specific-file">4.1. config_machines.xml - machine specific file</a></li>
<li><a class="reference internal" href="#batch-system-definition">4.2. Batch system definition</a></li>
<li><a class="reference internal" href="#config-batch-xml-batch-directives">4.3. config_batch.xml - batch directives</a></li>
<li><a class="reference internal" href="#compiler-settings">4.4. Compiler settings</a></li>
<li><a class="reference internal" href="#config-compilers-xml-compiler-paths-and-options">4.5. config_compilers.xml - compiler paths and options</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="grids.html"
                        title="previous chapter">3. Model grids</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="pes-threads.html"
                        title="next chapter">5. Controlling processors and threads</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/users_guide/machine.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="pes-threads.html" title="5. Controlling processors and threads"
             >next</a> |</li>
        <li class="right" >
          <a href="grids.html" title="3. Model grids"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">CIME 5.6 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Case Control System Part 1: Basic Usage</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, U.S. National Science Foundation and U.S. Department of Energy.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.3.
    </div>
  </body>
</html>