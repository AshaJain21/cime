
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>11. Workflows &#8212; CIME 5.6 documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="12. Directory content" href="cime-dir.html" />
    <link rel="prev" title="10. Multi-instance component functionality" href="multi-instance.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="cime-dir.html" title="12. Directory content"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="multi-instance.html" title="10. Multi-instance component functionality"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">CIME 5.6 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Case Control System Part 1: Basic Usage</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="workflows">
<span id="id1"></span><h1>11. Workflows<a class="headerlink" href="#workflows" title="Permalink to this headline">¶</a></h1>
<p>Currently, there are three kinds of workflow controls available in CIME.</p>
<ol class="arabic">
<li><p class="first">Multiple jobs workflow</p>
<p>The file, <strong>$CIMEROOT/config/$model/machines/config_batch.xml</strong>, contains a section called <code class="docutils literal notranslate"><span class="pre">&lt;batch_jobs&gt;</span></code> which defines the submit script templates and the pre-requisites for running them.
As an example, in cesm, the default <code class="docutils literal notranslate"><span class="pre">&lt;batch_jobs&gt;</span></code> section is the following, with an explanation give by the NOTES additions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;batch_jobs&gt;
   &lt;!-- order matters, with no-batch jobs will be run in the order listed here --&gt;
   &lt;job name=&quot;case.run&quot;&gt;
     &lt;template&gt;template.case.run&lt;/template&gt;
     &lt;prereq&gt;$BUILD_COMPLETE and not $TEST&lt;/prereq&gt;
   &lt;/job&gt;
   &lt;job name=&quot;case.test&quot;&gt;
      &lt;template&gt;template.case.test&lt;/template&gt;
      &lt;prereq&gt;$BUILD_COMPLETE and $TEST&lt;/prereq&gt;
   &lt;/job&gt;
   &lt;job name=&quot;case.st_archive&quot;&gt;
      &lt;template&gt;template.st_archive&lt;/template&gt;
      &lt;task_count&gt;1&lt;/task_count&gt;
      &lt;walltime&gt;0:20:00&lt;/walltime&gt;
      &lt;!-- If DOUT_S is true and case.run (or case.test) exits successfully then run st_archive--&gt;
      &lt;dependency&gt;case.run or case.test&lt;/dependency&gt;
      &lt;prereq&gt;$DOUT_S&lt;/prereq&gt;
   &lt;/job&gt;
&lt;/batch_jobs&gt;
</pre></div>
</div>
<p>The elements that can be contained in the <code class="docutils literal notranslate"><span class="pre">&lt;batch_jobs&gt;</span></code> section are:</p>
<ul class="simple">
<li>&lt;job name=”NAME”&gt; : the name of the batch job.</li>
</ul>
<p>Batch jobs can contain one or more jobs, and each job has the following elements:</p>
<ul class="simple">
<li>&lt;template&gt; : required, the associated template that is used to create the job.</li>
<li>&lt;prepreq&gt; : required, the pre-requiste settings of xml variables that determine whether the job will be run.</li>
<li>&lt;task_count&gt; : optional, the number of tasks the job should use.</li>
<li>&lt;walltime&gt; : optional, the maximum walltime the job should require.</li>
<li>&lt;dependency&gt; : optional, the previous job expected to complete before this job can start.</li>
</ul>
<p>In the above the scripts for each <code class="docutils literal notranslate"><span class="pre">&lt;job&gt;</span></code> entry,
i.e. <code class="docutils literal notranslate"><span class="pre">case.run</span></code>, <code class="docutils literal notranslate"><span class="pre">case.test</span></code> and <code class="docutils literal notranslate"><span class="pre">case.st_archive</span></code> are
created from their respective templates the corresponding
<code class="docutils literal notranslate"><span class="pre">&lt;template&gt;</span></code> entry. The templates are located in the
<strong>$CIMEROOT/config/$model/machines</strong> directory.</p>
<p>Furthermore, in the above <code class="docutils literal notranslate"><span class="pre">case.run</span></code> will be run if the xml
variables <code class="docutils literal notranslate"><span class="pre">BUILD_COMPLETE</span></code> is true and <code class="docutils literal notranslate"><span class="pre">TEST</span></code> is false.  On the
other hand, if <code class="docutils literal notranslate"><span class="pre">BUILD_COMPLETE</span></code> is true and <code class="docutils literal notranslate"><span class="pre">TEST</span></code> is true then
<code class="docutils literal notranslate"><span class="pre">case.test</span></code> will be run.  In addition, if <code class="docutils literal notranslate"><span class="pre">DOUT_S</span></code> is true,
then <code class="docutils literal notranslate"><span class="pre">case.st_archive</span></code> will be run <strong>after</strong> either <code class="docutils literal notranslate"><span class="pre">case.run</span></code>
or <code class="docutils literal notranslate"><span class="pre">case.test</span></code> successfully completes. Also note that
<code class="docutils literal notranslate"><span class="pre">case.st_archive</span></code> is a separate job that only requests a single
task.</p>
<p>Users can extend the above workflow with their own custom needs.</p>
</li>
<li><p class="first">Pre-run and post-run script</p>
<p>CIME provides the ability to execute user-defined scripts during
the execution of <code class="docutils literal notranslate"><span class="pre">case.run</span></code>. These user-defined scripts can be
invoked either before and/or after the model is run. The xml variables that controls this capability are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">PRERUN_SCRIPT</span></code>: points to an external script to be run before model execution.</li>
<li><code class="docutils literal notranslate"><span class="pre">POSTRUN_SCRIPT</span></code>: points to an external script to be run after successful model completion.</li>
</ul>
<p>Note, that when these scripts are called, the full processor allocation for the job will be used - even if only 1 processor actually is invoked for the external script.</p>
</li>
<li><p class="first">Data assimilation controls</p>
</li>
</ol>
<blockquote>
<div><p>CIME provides the ability to hook in a data assimilation utility via a set of xml variables:</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">DATA_ASSIMILATION_SCRIPT</span></code>:  points to an external script to be run <strong>after</strong> model completion</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">DATA_ASSIMILATION_CYCLES</span></code>: integer that controls the number of data assimilation cycles. The run script
will loop over these number of data assimilation cycles and for each cycle will run the model and subsequently run the data assimilation script.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">DATA_ASSIMILATION</span></code>: if set to TRUE for a given component, then
a resume signal will be sent to that component at
initialization. If set, the component will execute special post
data assimilation logic on initialization.  See the component
documentation for details. This flag is a bit subtle in that it is a per-component flag, not a model wide flag.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">To</span> <span class="n">see</span> <span class="n">what</span> <span class="n">the</span> <span class="n">component</span> <span class="n">flags</span> <span class="n">are</span> <span class="n">call</span>
 <span class="o">&gt;</span> <span class="o">./</span><span class="n">xmlquery</span> <span class="n">DATA_ASSIMILATION</span>

<span class="n">The</span> <span class="n">output</span> <span class="n">will</span> <span class="n">look</span> <span class="n">like</span>
 <span class="o">&gt;</span>   <span class="n">DATA_ASSIMILATION</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;CPL:FALSE&#39;</span><span class="p">,</span> <span class="s1">&#39;ATM:TRUE&#39;</span><span class="p">,</span> <span class="s1">&#39;LND:FALSE&#39;</span><span class="p">,</span> <span class="s1">&#39;ICE:FALSE&#39;</span><span class="p">,</span> <span class="s1">&#39;OCN:FALSE&#39;</span><span class="p">,</span> <span class="s1">&#39;ROF:FALSE&#39;</span><span class="p">,</span> <span class="s1">&#39;GLC:FALSE&#39;</span><span class="p">,</span> <span class="s1">&#39;WAV:FALSE&#39;</span><span class="p">]</span>

 <span class="n">To</span> <span class="n">change</span> <span class="n">the</span> <span class="n">LND</span> <span class="n">value</span> <span class="n">to</span> <span class="n">TRUE</span> <span class="n">issue</span>
 <span class="o">&gt;</span> <span class="o">./</span><span class="n">xmlchange</span> <span class="n">DATA_ASSIMILATION_LND</span><span class="o">=</span><span class="n">TRUE</span>
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="multi-instance.html"
                        title="previous chapter">10. Multi-instance component functionality</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="cime-dir.html"
                        title="next chapter">12. Directory content</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/users_guide/workflows.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="cime-dir.html" title="12. Directory content"
             >next</a> |</li>
        <li class="right" >
          <a href="multi-instance.html" title="10. Multi-instance component functionality"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">CIME 5.6 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Case Control System Part 1: Basic Usage</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, U.S. National Science Foundation and U.S. Department of Energy.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.3.
    </div>
  </body>
</html>